<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lenny Christmas Wheel</title>
    <!-- Meta tags per condivisione social -->
    <meta name="description" content="Gira la Ruota di Natale Lenny e vinci fantastici sconti!">
    <meta property="og:title" content="Lenny Christmas Wheel ðŸŽ„">
    <meta property="og:description" content="Gira la ruota e scopri il tuo regalo di Natale!">
    <meta property="og:type" content="website">
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@500&display=swap" rel="stylesheet">
    <style>
        /* --- STILE VISIVO --- */
        body {
            font-family: 'Quicksand', sans-serif;
            background-color: #0f2e18;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden;
            position: relative;
        }

        h1 {
            color: #d4af37;
            text-align: center;
            margin-bottom: 5px;
            text-shadow: 1px 1px 5px rgba(0, 0, 0, 0.5);
        }

        .subtitle {
            font-size: 1.1rem;
            color: #eee;
            margin-bottom: 25px;
            text-align: center;
            max-width: 600px;
            line-height: 1.4;
        }

        /* Login Screen */
        #login-screen {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid #d4af37;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
            transition: transform 0.3s;
        }

        input[type="email"] {
            padding: 12px;
            font-size: 16px;
            border-radius: 25px;
            border: none;
            width: 80%;
            margin-bottom: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        #game-area {
            display: none;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        .wheel-container {
            position: relative;
            width: 400px; /* Grandezza Ruota */
            height: 400px;
            margin: 10px auto;
        }

        canvas {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.4);
            border: 6px solid #d4af37;
            transform: rotate(-90deg); /* Ruota canvas per start a ore 12 */
        }

        .arrow {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            border-left: 25px solid transparent;
            border-right: 25px solid transparent;
            border-top: 50px solid #c41e3a;
            z-index: 20;
            filter: drop-shadow(0 4px 4px rgba(0,0,0,0.5));
        }

        /* Logo Centrale */
        .center-logo {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 160px; /* Grandezza Logo */
            height: 160px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            border: 4px solid #d4af37;
            z-index: 15;
            object-fit: contain; /* Adatta l'immagine */
            padding: 5px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
        }

        button {
            padding: 15px 50px;
            font-size: 1.3rem;
            background-color: #c41e3a;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.4);
            margin-top: 20px;
        }
        button:hover { 
            transform: scale(1.05); 
            background-color: #a01830; 
        }
        button:disabled { 
            background-color: #d4af37; 
            cursor: pointer; 
        }

        /* Modal */
        #prize-modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            padding: 30px;
            border-radius: 15px;
            max-width: 400px;
            text-align: center;
            border: 4px solid #c41e3a;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
        }
        .modal-code { 
            background: #eee; 
            padding: 10px; 
            font-family: monospace; 
            font-size: 22px; 
            letter-spacing: 2px; 
            border: 1px dashed #333; 
            display: inline-block; 
            margin: 20px 0; 
            font-weight: bold; 
            color: #c41e3a;
        }

        /* Nevicate */
        .snowflake {
            position: absolute;
            top: -10%;
            color: white;
            font-size: 1.5rem;
            pointer-events: none;
            animation: fall linear infinite;
        }

        @keyframes fall {
            0% { transform: translateY(0); }
            100% { transform: translateY(100vh); }
        }
    </style>
</head>
<body>

    <!-- Effetto Neve -->
<script>
    const snowflakes = 100;
    const body = document.body;

    for (let i = 0; i < snowflakes; i++) {
        const snowflake = document.createElement('div');
        snowflake.classList.add('snowflake');
        snowflake.style.position = 'absolute';
        snowflake.style.backgroundColor = 'white';
        snowflake.style.borderRadius = '50%';
        snowflake.style.width = Math.random() * 5 + 'px'; // Dimensione variabile
        snowflake.style.height = snowflake.style.width; // Mantiene la forma circolare
        snowflake.style.left = Math.random() * 100 + 'vw';
        snowflake.style.opacity = Math.random();
        snowflake.style.animationDuration = Math.random() * 3 + 2 + 's';
        snowflake.style.animationName = 'fall'; // Usa l'animazione esistente
        body.appendChild(snowflake);
    }
</script>

    <div id="login-screen">
        <h2 style="color: #d4af37;">ðŸŽ„ Lenny Christmas Wheel ðŸŽ„</h2>
        <p>Inserisci la tua email per sbloccare la ruota.</p>
        <input type="email" id="userEmail" placeholder="latua@email.com">
        <br>
        <button onclick="checkAccess()">Entra</button>
        <p id="login-error" style="color: #ff6b6b; margin-top: 10px; font-size: 14px;"></p>
    </div>

    <div id="game-area">
        <h1>ðŸŽ„ Lenny Christmas Wheel ðŸŽ„</h1>
        <div class="subtitle">Clicca qui sotto per girare la ruota delle feste e scoprire il tuo regalo di Natale</div>
        
        <div class="wheel-container">
            <div class="arrow"></div>
            <canvas id="wheelCanvas" width="800" height="800"></canvas>
            
            <img src="https://www.lenny.sm/wp-content/uploads/2022/12/LOGO-lenny-landing-new.png" class="center-logo" alt="Logo">
        </div>
        
        <button id="spinBtn" onclick="spinWheel()">GIRA ORA</button>
    </div>

    <div id="prize-modal">
        <div class="modal-content">
            <h2 id="modal-title" style="color:#c41e3a">Vittoria!</h2>
            <p id="modal-desc">Ecco il tuo premio:</p>
            <div id="modal-code" class="modal-code">CODICE</div>
            <p id="modal-expiry" style="font-size: 14px; color: #666; margin-top: 10px; font-weight: bold;">Il coupon scade il 01/02/2026</p>
            <br>
            <button onclick="document.getElementById('prize-modal').style.display='none'">Chiudi</button>
        </div>
    </div>

    <script>
        /* ===========================================================
        ðŸ› ï¸ CONFIGURAZIONE MODIFICABILE ðŸ› ï¸
        Modifica SOLO qui dentro per cambiare premi e probabilitÃ .
        La somma delle 'probabilita' deve fare 100 per precisione visiva.
        ===========================================================
        */
        const configurazione = {
            googleFormUrl: "https://docs.google.com/forms/d/e/1FAIpQLScY_gJ0nnqFBydzNOeH-2XavFwiRHCqrPyiT7vSRGExWsndZw/formResponse", // Lascia vuoto se non lo usi ancora

            spicchi: [
        { 
            etichetta: "ðŸŽ…ðŸ»ðŸŽ…ðŸ»ðŸŽ…ðŸ»",   
            codice: "LXMAS",            
            probabilita: 32, 
            colore: "#c41e3a", 
            descrizione: "Il valore del codice Ã¨: 5% di sconto sul tuo prossimo ordine! Usa questo codice nel carrello per il tuo sconto natalizio!"
        },
        { 
            etichetta: "â„ï¸â„ï¸â„ï¸", 
            codice: "LSHOT", 
            probabilita: 27, 
            colore: "#165b33", 
            descrizione: "Il valore del codice Ã¨: 5â‚¬ di sconto sul tuo prossimo ordine con un minimo d'ordine di 25â‚¬! Usa questo codice nel carrello per il tuo sconto natalizio!"
        },
        { 
            etichetta: "ðŸŽ„ðŸŽ„ðŸŽ„", 
            codice: "LBOOST", 
            probabilita: 19, 
            colore: "#d4af37", 
            descrizione: "Il valore del codice Ã¨: 15% di sconto sul tuo prossimo ordine con un massimo d'ordine di 70â‚¬! Usa questo codice nel carrello per il tuo sconto natalizio!"
        },
        { 
            etichetta: "ðŸŽðŸŽðŸŽ", 
            codice: "LBOUNTY", 
            probabilita: 15, 
            colore: "#ffffff", 
            testoColore: "#c41e3a",
            descrizione: "Hai trovato il Bounty di Natale! Il valore del codice Ã¨: 10â‚¬ di sconto sul tuo prossimo ordine con un minimo d'ordine di 25â‚¬! Usa questo codice nel carrello per il tuo sconto natalizio!"
        },
        { 
            etichetta: "ðŸ’¥ðŸ’¥ðŸ’¥", 
            codice: "LJACKPOT", 
            probabilita: 7, 
            colore: "#000000", 
            descrizione: "INCREDIBILE! Hai vinto il premio piÃ¹ alto della Lenny Christmas Wheel! Il valore del codice Ã¨: 25% di sconto sul tuo prossimo ordine con un massimo d'ordine di 70â‚¬! Usa questo codice nel carrello per il tuo sconto natalizio!"
        }
    ]
};
        // --- MOTORE DEL GIOCO (NON TOCCARE SE POSSIBILE) ---
        let userEmail = "";
        const canvas = document.getElementById('wheelCanvas');
        const ctx = canvas.getContext('2d');
        let currentRotation = 0; // Gradi totali accumulati
        let isSpinning = false;

        // 1. Controllo Accesso
        function checkAccess() {
            const input = document.getElementById('userEmail');
            const email = input.value.trim().toLowerCase();
            const errorMsg = document.getElementById('login-error');
            
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

            if (!emailRegex.test(email)) {
                errorMsg.innerText = "Per favore, inserisci un'email valida.";
                return;
            }

            // Controlla se ha giÃ  giocato (stesso dispositivo)
            if (localStorage.getItem('played_' + email) || localStorage.getItem('has_played_ever')) {
                errorMsg.innerText = "Questa email ha giÃ  partecipato o hai giÃ  giocato da questo dispositivo!";
                return;
            }

            userEmail = email;
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('game-area').style.display = 'flex';
            drawWheel();
        }

        // 2. Disegno Ruota Proporzionale
        function drawWheel() {
            let startAngle = 0;
            const totalProb = 100;

            configurazione.spicchi.forEach((spicchio) => {
                const sliceAngle = (spicchio.probabilita / totalProb) * (2 * Math.PI);
                
                ctx.beginPath();
                ctx.moveTo(400, 400);
                ctx.arc(400, 400, 400, startAngle, startAngle + sliceAngle);
                ctx.fillStyle = spicchio.colore;
                ctx.fill();
                ctx.strokeStyle = "#d4af37";
                ctx.lineWidth = 2;
                ctx.stroke();

                ctx.save();
                ctx.translate(400, 400);
                ctx.rotate(startAngle + sliceAngle / 2);
                ctx.textAlign = "right";
                ctx.fillStyle = spicchio.testoColore || "#fff";
                ctx.font = "bold 28px Arial"; 
                ctx.fillText(spicchio.etichetta, 360, 10); 
                ctx.restore();

                startAngle += sliceAngle;
            });
        }

        // 3. Logica Rotazione
        function spinWheel() {
            if (isSpinning) return;
            isSpinning = true;

            const rand = Math.random() * 100;
            let accum = 0;
            let winnerIndex = 0;
            
            for (let i = 0; i < configurazione.spicchi.length; i++) {
                accum += configurazione.spicchi[i].probabilita;
                if (rand <= accum) {
                    winnerIndex = i;
                    break;
                }
            }

            let startDeg = 0;
            for(let j=0; j<winnerIndex; j++){
                startDeg += (configurazione.spicchi[j].probabilita / 100) * 360;
            }
            let sliceDeg = (configurazione.spicchi[winnerIndex].probabilita / 100) * 360;
            let centerOfSlice = startDeg + (sliceDeg / 2);

            const baseSpins = 5 * 360; // 5 giri completi
            const targetRotation = baseSpins + (360 - centerOfSlice);
            
            let startTime = null;
            const duration = 5000;

            function animate(timestamp) {
                if (!startTime) startTime = timestamp;
                const progress = (timestamp - startTime) / duration;
                
                if (progress < 1) {
                    const ease = 1 - Math.pow(1 - progress, 4);
                    const currentDeg = currentRotation + (targetRotation * ease);
                    canvas.style.transform = `rotate(${currentDeg - 90}deg)`;
                    requestAnimationFrame(animate);
                } else {
                    currentRotation += targetRotation;
                    canvas.style.transform = `rotate(${currentRotation - 90}deg)`;
                    isSpinning = false;
                    endGame(winnerIndex);
                }
            }
            requestAnimationFrame(animate);
        }

        // 4. Fine Gioco e Salvataggio
        function endGame(index) {
            const premio = configurazione.spicchi[index];
            
            // Salva permanentemente che ha giocato
            localStorage.setItem('played_' + userEmail, 'true');
            localStorage.setItem('has_played_ever', 'true'); // Blocco dispositivo
            localStorage.setItem('won_prize', JSON.stringify({
                codice: premio.codice,
                descrizione: premio.descrizione
            }));
            
            document.getElementById('modal-title').innerText = "Ecco il tuo regalo, ti auguriamo buone feste a pancia piena! ";
            document.getElementById('modal-desc').innerText = premio.descrizione;
            document.getElementById('modal-code').innerText = premio.codice;
            document.getElementById('prize-modal').style.display = 'flex';
            
            const spinBtn = document.getElementById('spinBtn');
            spinBtn.innerText = "Rivedi Premio";
            spinBtn.onclick = showPrizeAgain;
            spinBtn.style.backgroundColor = "#d4af37";

            saveToGoogleSheets(userEmail, premio.codice);
        }

        // Nuova funzione per riaprire il modal
        function showPrizeAgain() {
            const savedPrize = JSON.parse(localStorage.getItem('won_prize'));
            if (savedPrize) {
                document.getElementById('modal-title').innerText = "Hai completato il tuo giro!";
                document.getElementById('modal-desc').innerText = savedPrize.descrizione;
                document.getElementById('modal-code').innerText = savedPrize.codice;
                document.getElementById('prize-modal').style.display = 'flex';
            }
        }

        // --- INTEGRAZIONE GOOGLE FORMS (Il trucco No-Backend) ---
        function saveToGoogleSheets(email, premio) {
            if (!configurazione.googleFormUrl) return;

            const formData = new FormData();
            formData.append("entry.1627556250", email);  
            formData.append("entry.1994468286", premio); 

            fetch(configurazione.googleFormUrl, {
                method: "POST",
                mode: "no-cors", 
                body: formData
            }).then(() => console.log("Salvato su Google Sheets"));
        }

        // Avvio iniziale
        drawWheel();
    </script>
</body>
</html>